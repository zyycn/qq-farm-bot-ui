:root {
  --font-scale: 1;
  --sidebar-width: clamp(248px, calc(280px * var(--font-scale)), 380px);
  --topbar-height: clamp(56px, calc(64px * var(--font-scale)), 88px);
  --log-filter-height: clamp(34px, calc(36px * var(--font-scale)), 46px);
  --log-filter-select-width: clamp(92px, calc(108px * var(--font-scale)), 150px);
  --log-filter-input-width: clamp(112px, calc(130px * var(--font-scale)), 190px);
  --log-filter-keyword-width: clamp(170px, calc(210px * var(--font-scale)), 300px);
  --log-filter-input-focus-width: clamp(132px, calc(154px * var(--font-scale)), 220px);
  --log-filter-keyword-focus-width: clamp(200px, calc(246px * var(--font-scale)), 340px);
  --settings-control-width: clamp(180px, calc(240px * var(--font-scale)), 340px);
  --fert-select-width: clamp(116px, calc(150px * var(--font-scale)), 208px);
  --font-main: "Microsoft YaHei", "PingFang SC", "Segoe UI", sans-serif;
  --bg: #10161b;
  --panel: #182129;
  --panel-2: #1e2a35;
  --line: #2c3a46;
  --text: #e8f0f7;
  --sub: #9eb0bf;
  --primary: #18a06f;
  --accent: #4ab1ff;
  --warn: #f2bc54;
  --danger: #f06f68;
  --btn-primary-bg: #18a06f;
  --btn-stop-bg: #ff9800;
  --btn-danger-bg: #f06f68;
  --tab-btn-bg: #10161b;
  --tab-btn-active-bg: #18a06f;
  --tab-btn-active-text: #ffffff;
  --sidebar-active-bg: #18a06f;
  --sidebar-active-text: #ffffff;
  --r: 10px;
}
body.light-theme {
  --bg: #f2f5f8;
  --panel: #ffffff;
  --panel-2: #f7fafd;
  --line: #dbe4ec;
  --text: #22313d;
  --sub: #657a8d;
  --primary: #148861;
  --accent: #2b80d8;
  --warn: #cb9430;
  --danger: #cb4e48;
  --btn-primary-bg: #58c79b;
  --btn-stop-bg: #ffbf66;
  --btn-danger-bg: #f08f8a;
  --tab-btn-bg: #eef4f8;
  --tab-btn-active-bg: #9fe2c7;
  --tab-btn-active-text: #1f2a33;
  --sidebar-active-bg: #9fe2c7;
  --sidebar-active-text: #1f2a33;
}
* { box-sizing: border-box; }
html, body { width: 100%; height: 100%; margin: 0; overflow-x: hidden; }
body { font-family: var(--font-main); background: var(--bg); color: var(--text); overflow: hidden; font-size: calc(15px * var(--font-scale)); }
input, select, textarea, button {
  font-family: inherit;
  font-size: inherit;
}

.app-shell { height: 100%; display: grid; grid-template-columns: var(--sidebar-width) 1fr; }
.app-sidebar { background: var(--panel); border-right: 1px solid var(--line); padding: 10px; display: flex; flex-direction: column; gap: 10px; }
.brand { display: flex; align-items: center; gap: 16px; font-weight: 700; padding: 12px 4px; font-size: calc(32px * var(--font-scale)); }
.brand i { color: var(--primary); }

.current-account {
  width: 100%; background: var(--panel-2); color: var(--text); border: 1px solid var(--line);
  border-radius: var(--r); padding: 8px 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
}
.account-dropdown { position: relative; display: none; max-height: 210px; overflow: auto; border: 1px solid var(--line); border-radius: var(--r); background: var(--panel-2); }
.account-dropdown.show { display: block; }
.account-option { padding: 8px 10px; display: flex; gap: 8px; align-items: center; cursor: pointer; }
.account-option:hover { background: rgba(255,255,255,0.04); }
.account-option.active { color: var(--primary); }
body.light-theme .account-option:hover { background: rgba(0,0,0,0.05); }

.nav-list { display: grid; gap: 8px; }
.nav-item {
  border: 1px solid transparent; border-radius: var(--r); padding: 8px 10px; color: var(--sub);
  text-decoration: none; display: flex; align-items: center; gap: 1em; font-size: calc(17px * var(--font-scale));
}
.nav-item i {
  width: 20px;
  min-width: 20px;
  text-align: center;
}
.nav-item span {
  flex: 1 1 auto;
  text-align: left;
}
.nav-item:hover { background: var(--panel-2); border-color: var(--line); color: var(--text); }
.nav-item.active { background: var(--sidebar-active-bg); color: var(--sidebar-active-text); }

.sidebar-foot { margin-top: auto; border: 1px solid var(--line); border-radius: var(--r); background: var(--panel-2); padding: 8px 10px; font-size: calc(13px * var(--font-scale)); display: flex; align-items: center; justify-content: space-between; gap: 10px; }
.conn { display: flex; align-items: center; gap: 10px; font-size: calc(18px * var(--font-scale)); font-weight: 700; }
.dot { width: 12px; height: 12px; border-radius: 999px; display: inline-block; }
.dot.online { background: #22d181; }
.dot.offline { background: #f16661; }
.uptime-mini { display: none; }
.system-time { display: block; text-align: right; margin: 0; color: var(--sub); font-size: calc(16px * var(--font-scale)); font-weight: 600; }

.app-main { display: grid; grid-template-rows: var(--topbar-height) 1fr; min-width: 0; max-width: 100%; overflow-x: hidden; }
.topbar { border-bottom: 1px solid var(--line); background: var(--panel); padding: 0 clamp(10px, calc(14px * var(--font-scale)), 20px); display: flex; align-items: center; justify-content: space-between; height: var(--topbar-height); }
.topbar h1 { margin: 0; font-size: calc(22px * var(--font-scale)); }
.topbar-actions { display: flex; gap: 6px; }
.topbar-actions { gap: clamp(6px, 0.8vh, 12px); }
.icon-btn {
  width: clamp(calc(28px * var(--font-scale)), 3vh, calc(42px * var(--font-scale)));
  height: clamp(calc(28px * var(--font-scale)), 3vh, calc(42px * var(--font-scale)));
  border: 1px solid var(--line);
  background: var(--panel-2);
  color: var(--sub);
  border-radius: clamp(6px, 0.8vh, 12px);
  cursor: pointer;
  font-size: calc(14px * var(--font-scale));
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.icon-btn:hover { color: var(--text); border-color: var(--primary); }

.page-wrap { overflow: auto; padding: 14px; max-width: 100%; overflow-x: hidden; }
.page { display: none; }
.page.active { display: block; }
.card { background: var(--panel); border: 1px solid var(--line); border-radius: var(--r); padding: 12px; margin-bottom: 14px; }
.card-head { display: flex; justify-content: space-between; align-items: center; gap: 8px; margin-bottom: 8px; }
.card-head h3 {
  margin: 0;
  font-size: calc(24px * var(--font-scale));
  display: flex;
  gap: 8px;
  align-items: center;
}
.card-head h3 i {
  font-size: 1em;
  width: 1.1em;
  text-align: center;
}

.compact-status {
  display: grid;
  grid-template-columns: repeat(8, minmax(0,1fr));
  gap: 10px;
}
.status-item {
  border: 1px solid var(--line); border-radius: 8px; padding: 12px; background: var(--panel-2);
  min-height: 78px; display: flex; flex-direction: column; justify-content: center;
}
.status-item.stretch { grid-column: span 2; }
.status-head { display: flex; align-items: center; gap: 6px; }
.si { width: 14px; text-align: center; font-size: calc(13px * var(--font-scale)); opacity: .95; }
.si.coin { color: #f0b84f; }
.si.level { color: #ffd86b; }
.si.exp { color: #4ab1ff; }
.si.total { color: #56d4a0; }
.si.time { color: #bca9ff; }
.si.rate { color: #7fe2dd; }
.status-item .k { font-size: calc(15px * var(--font-scale)); color: var(--sub); }
.status-item .v { font-size: calc(28px * var(--font-scale)); font-weight: 700; margin-top: 3px; line-height: 1.2; }
.status-item .s { font-size: calc(14px * var(--font-scale)); color: var(--sub); margin-top: 3px; }
.status-dual-row { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 10px; width: 100%; }
.status-dual-row.gold-split { grid-template-columns: 6fr 4fr; }
.status-dual-col { min-width: 0; }
.status-dual-col + .status-dual-col {
  border-left: 1px solid var(--line);
  padding-left: 10px;
}
.status-item.runtime-item {
  min-height: 58px;
  padding: 6px 9px;
}
.status-item.runtime-item .v {
  font-size: calc(27px * var(--font-scale));
}
.status-item.runtime-item .k { font-size: calc(13px * var(--font-scale)); }
.status-item .gain-gold { color: var(--primary); font-weight: 600; }
.status-item .gain-gold.negative { color: var(--danger); }
.gold-card .status-dual-col .gain-gold {
  display: block;
  margin-top: 2px;
  line-height: 1.2;
}
.gold-card .v { font-size: calc(26px * var(--font-scale)); }
.exp-meta-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin-top: 2px;
}
.exp-inline #stat-exp { color: var(--primary); font-weight: 600; }
.status-account {
  margin-top: 8px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
  gap: 8px;
  min-width: 0;
}
.status-account-item .status-account { margin-top: 0; }
.status-account img,
.status-account #topbar-account-fallback {
  width: clamp(calc(56px * var(--font-scale)), 6.4vh, calc(108px * var(--font-scale)));
  height: clamp(calc(56px * var(--font-scale)), 6.4vh, calc(108px * var(--font-scale)));
  border-radius: 999px;
  flex-shrink: 0;
}
.status-account img { object-fit: cover; border: 1px solid var(--line); background: #fff; }
.status-account #topbar-account-fallback {
  display: inline-flex; align-items: center; justify-content: center;
  background: rgba(24,160,111,.2); color: var(--text); font-size: clamp(calc(18px * var(--font-scale)), 2.3vh, calc(34px * var(--font-scale))); font-weight: 700;
}
.status-account-meta {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 2px;
  min-width: 0;
}
.status-account #topbar-account-name {
  max-width: 260px;
  overflow: hidden;
  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  font-size: calc(17px * var(--font-scale));
  line-height: 1.2;
  color: var(--text);
}
.status-account #topbar-account-status {
  font-size: calc(15px * var(--font-scale));
  color: var(--sub);
}

@media (min-width: 981px) {
  #page-accounts .accounts-grid {
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;
  }
  #page-accounts .acc-item {
    width: fit-content;
    max-width: 100%;
  }
  #page-accounts .acc-actions {
    flex-wrap: nowrap;
    justify-content: flex-start;
    gap: clamp(5px, 0.7vh, 10px);
    width: max-content;
  }
  #page-accounts .acc-btn {
    white-space: nowrap;
  }
  .app-main {
    height: 100dvh;
    grid-template-rows: var(--topbar-height) minmax(0, 1fr);
  }
  .topbar { height: var(--topbar-height); }
  .page-wrap {
    height: 100%;
    min-height: 0;
    overflow: auto;
  }
  #page-dashboard.page.active {
    height: 100%;
    min-height: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  #page-accounts.page.active {
    height: 100%;
    min-height: 0;
    display: flex;
    flex-direction: column;
    gap: clamp(10px, 1.1vh, 18px);
    padding-bottom: clamp(10px, 1.2vh, 20px);
  }
  #page-accounts.page.active > .card:first-child {
    margin-bottom: 0;
  }
  #page-accounts.page.active > .card:last-child {
    flex: 1;
    min-height: 0;
    margin-bottom: 0;
    display: flex;
    flex-direction: column;
  }
  #page-accounts.page.active > .card:last-child .logs-container {
    flex: 1;
    min-height: 0;
    height: auto;
    max-height: none;
  }
  #page-dashboard.page.active .dashboard-grid {
    flex: 1;
    height: 100%;
    min-height: 0;
    overflow: hidden;
    grid-template-rows: minmax(0, 1fr);
    align-content: stretch;
  }
  #page-dashboard.page.active .dashboard-grid .card {
    margin-bottom: 0;
  }
  #page-dashboard.page.active .logs-card,
  #page-dashboard.page.active .side-stack {
    height: 100%;
    min-height: 0;
  }
  #page-dashboard.page.active .logs-container {
    height: auto;
    min-height: 0;
    max-height: none;
    flex: 1;
  }
  .dashboard-grid > .logs-card { margin-bottom: 0; }
  #page-dashboard .compact-status { margin-bottom: 22px; }
  #page-dashboard .dashboard-grid {
    grid-template-columns: 4fr 1fr;
    column-gap: 18px;
    row-gap: 22px;
    align-items: stretch;
  }
  #page-dashboard .side-stack {
    gap: clamp(8px, 1.1vh, 12px);
    grid-template-rows: minmax(clamp(140px, 18vh, 220px), auto) minmax(0, 1fr);
  }
  #page-dashboard .side-stack > .card {
    margin-bottom: 0;
    min-height: 0;
    display: flex;
    flex-direction: column;
  }
  #page-dashboard .side-stack .card-head h3 {
    font-size: clamp(calc(20px * var(--font-scale)), calc(24px * var(--font-scale)), calc(34px * var(--font-scale)));
  }
  #page-dashboard .ops-list {
    flex: 1;
    min-height: 0;
    display: grid;
    grid-auto-rows: auto;
    gap: clamp(5px, 0.8vh, 9px);
    align-content: start;
    overflow-y: auto;
    overflow-x: hidden;
    padding-right: 2px;
  }
  #page-dashboard .ops-list.equal-rows {
    grid-auto-rows: minmax(0, 1fr);
    align-content: stretch;
    overflow-y: hidden;
  }
  #page-dashboard .ops-list .op-stat {
    padding: clamp(7px, 0.8vh, 10px) clamp(9px, 0.9vw, 12px);
    align-items: center;
    min-height: clamp(30px, 3vh, 38px);
  }
  #page-dashboard .ops-list .op-stat .label {
    font-size: clamp(calc(16px * var(--font-scale)), calc(20px * var(--font-scale)), calc(26px * var(--font-scale)));
    display: inline-flex;
    align-items: center;
    line-height: 1.2;
  }
  #page-dashboard .ops-list .op-stat .count {
    font-size: clamp(calc(18px * var(--font-scale)), calc(23px * var(--font-scale)), calc(30px * var(--font-scale)));
    display: inline-flex;
    align-items: center;
    line-height: 1.2;
  }
  #page-dashboard .next-check-item .label {
    font-size: clamp(calc(16px * var(--font-scale)), calc(20px * var(--font-scale)), calc(26px * var(--font-scale)));
    display: inline-flex;
    align-items: center;
    line-height: 1.2;
  }
  #page-dashboard .next-check-item .value {
    font-size: clamp(calc(18px * var(--font-scale)), calc(23px * var(--font-scale)), calc(30px * var(--font-scale)));
    display: inline-flex;
    align-items: center;
    line-height: 1.2;
  }
  #page-dashboard #card-efficiency .switches-list {
    flex: 1;
    min-height: 0;
    gap: clamp(4px, 0.7vh, 8px);
    align-content: space-between;
    padding-bottom: clamp(calc(6px * var(--font-scale)), 0.9vh, calc(14px * var(--font-scale)));
  }
  #page-dashboard #card-efficiency .card-head {
    margin-bottom: clamp(calc(6px * var(--font-scale)), 0.9vh, calc(14px * var(--font-scale)));
  }
  #page-dashboard #card-efficiency .form-group label {
    font-size: clamp(calc(16px * var(--font-scale)), calc(20px * var(--font-scale)), calc(27px * var(--font-scale)));
    line-height: 1.25;
  }
  #page-dashboard #card-efficiency .form-group .form-control {
    font-size: clamp(calc(16px * var(--font-scale)), calc(20px * var(--font-scale)), calc(27px * var(--font-scale)));
    min-height: clamp(32px, 2.4vh, 40px);
  }
  #page-dashboard .switch-item {
    font-size: clamp(calc(16px * var(--font-scale)), calc(20px * var(--font-scale)), calc(27px * var(--font-scale)));
    min-height: clamp(26px, 2.6vh, 34px);
    line-height: 1.2;
  }
  #page-dashboard #card-efficiency .form-group.compact {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    align-items: center;
    justify-content: stretch;
    gap: clamp(6px, 0.8vh, 12px);
    margin-top: clamp(calc(2px * var(--font-scale)), 0.3vh, calc(6px * var(--font-scale)));
    margin-bottom: 0;
  }
  #page-dashboard #card-efficiency .form-group.compact label {
    margin: 0;
    grid-column: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: clamp(26px, 2.6vh, 34px);
    text-align: center;
  }
  #page-dashboard #card-efficiency .form-group.compact .form-control {
    grid-column: 3;
    justify-self: center;
    width: min(100%, var(--fert-select-width));
    min-width: clamp(88px, calc(100px * var(--font-scale)), 132px);
    max-width: var(--fert-select-width);
    margin: 0;
  }
  #page-dashboard #card-efficiency #fertilizer-select {
    text-align: center;
    text-align-last: center;
  }
  #page-dashboard #card-efficiency #fertilizer-select option {
    text-align: center;
  }
  /* 低于 1080p 高度时，统计栏允许内部滚动，防止卡片挤压重叠 */
  @media (max-height: 1079px) and (min-width: 981px) {
    #page-dashboard #card-efficiency .switches-list {
      overflow-y: auto;
      overflow-x: hidden;
      padding-right: 2px;
    }
  }
  #page-dashboard #card-efficiency .switch-item > span:first-child {
    display: inline-flex;
    align-items: center;
    min-height: inherit;
  }
  #page-dashboard #card-efficiency .switch-item .slider {
    align-self: center;
    flex-shrink: 0;
  }
  .app-sidebar { padding: 12px; gap: 12px; }
  .brand { font-size: calc(34px * var(--font-scale)); }
  .brand i { font-size: calc(36px * var(--font-scale)); }
  .current-account {
    padding: 12px 14px;
    font-size: calc(16px * var(--font-scale));
    border-radius: 12px;
  }
  .account-dropdown { max-height: 280px; }
  .account-option {
    padding: 10px 12px;
    font-size: calc(15px * var(--font-scale));
  }
  .nav-list { gap: 10px; }
  .nav-item { padding: 10px 12px; font-size: calc(18px * var(--font-scale)); }
  .compact-status {
    grid-template-columns: repeat(8, minmax(0,1fr));
    gap: 16px;
  }
  .compact-status .status-item {
    padding: 10px;
  }
  .status-account {
    gap: 12px;
  }
  .status-account img,
  .status-account #topbar-account-fallback {
    width: clamp(calc(64px * var(--font-scale)), 7vh, calc(124px * var(--font-scale)));
    height: clamp(calc(64px * var(--font-scale)), 7vh, calc(124px * var(--font-scale)));
  }
  .status-account #topbar-account-fallback {
    font-size: clamp(calc(20px * var(--font-scale)), 2.6vh, calc(40px * var(--font-scale)));
  }
  .status-account #topbar-account-name {
    max-width: 300px;
    font-size: calc(20px * var(--font-scale));
    font-weight: 600;
    line-height: 1.2;
  }
  .status-account #topbar-account-status {
    font-size: calc(17px * var(--font-scale));
    line-height: 1.2;
  }
}
.exp-inline { display: flex; align-items: baseline; gap: 8px; margin-top: 2px; }
.inline-select { margin-left: 4px; font-size: calc(12px * var(--font-scale)); border: none; background: transparent; color: var(--sub); }
.progress { width: 100%; height: 5px; border-radius: 999px; background: rgba(255,255,255,0.12); overflow: hidden; margin-top: 4px; }
.progress.progress-half { width: 100%; min-width: 0; max-width: 100%; }
body.light-theme .progress { background: rgba(0,0,0,0.08); }
.progress-fill { height: 100%; background: linear-gradient(90deg, #3ea9ff, #6ad7ff); }

.dashboard-grid { display: grid; grid-template-columns: 4fr 1fr; gap: 14px; align-items: stretch; }
.side-stack { display: grid; gap: 14px; }
.logs-card { display: flex; flex-direction: column; min-height: 0; height: auto; max-height: none; }

.logs-container {
  border: 1px solid var(--line); border-radius: 8px; padding: 6px 8px;
  height: clamp(420px, calc(100dvh - 340px), 1400px);
  min-height: 420px;
  max-height: min(1400px, calc(100dvh - 180px));
  overflow-y: auto;
  overflow-x: hidden;
  font-family: var(--font-main); font-size: calc(15px * var(--font-scale)); background: var(--panel-2);
  flex: 1;
}
.log-row { display: flex; gap: 8px; border-bottom: 1px dashed var(--line); padding: 4px 0; min-width: 0; }
.log-row:last-child { border-bottom: 0; }
.log-time { color: var(--sub); min-width: 70px; }
.log-tag { color: var(--accent); min-width: 60px; }
.log-msg { flex: 1; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.log-row.warn .log-msg { color: var(--warn); }

.log-filters {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
  align-items: center;
  max-width: 100%;
  overflow: visible;
  padding-bottom: 0;
  justify-content: flex-end;
}
.log-filter-select,
.log-filter-input {
  height: var(--log-filter-height);
  min-height: var(--log-filter-height);
  padding: 0 clamp(8px, calc(10px * var(--font-scale)), 14px);
  border-radius: 999px;
  font-size: calc(12px * var(--font-scale));
  line-height: 1.2;
  background: transparent;
  border-color: var(--line);
  color: var(--sub);
}
.log-filter-select {
  width: var(--log-filter-select-width);
  min-width: var(--log-filter-select-width);
  padding-top: 0;
  padding-bottom: 0;
  line-height: calc(var(--log-filter-height) - 2px);
}
.log-filter-input {
  width: var(--log-filter-input-width);
  min-width: var(--log-filter-input-width);
  transition: width 0.18s ease, color 0.18s ease, border-color 0.18s ease;
}
#logs-keyword-filter {
  width: var(--log-filter-keyword-width);
  min-width: var(--log-filter-keyword-width);
}
.log-filter-input:focus {
  width: var(--log-filter-input-focus-width);
  color: var(--text);
  border-color: var(--primary);
}
#logs-keyword-filter:focus {
  width: var(--log-filter-keyword-focus-width);
}
.log-filter-select:focus {
  color: var(--text);
  border-color: var(--primary);
}

.form-control { border: 1px solid var(--line); border-radius: 8px; background: var(--panel-2); color: var(--text); padding: 7px 9px; font-size: calc(14px * var(--font-scale)); }
.form-control:focus { outline: none; border-color: var(--primary); }

.ops-list { display: grid; gap: 8px; }
.ops-list { min-height: 220px; align-content: start; }
.op-stat { display: flex; justify-content: space-between; padding: 9px 10px; border: 1px solid var(--line); border-radius: 8px; background: var(--panel-2); }
.op-stat .count { color: var(--accent); font-weight: 700; }
.op-stat .label {
  display: inline-flex;
  align-items: center;
  gap: 0.5em;
}
.op-stat .label i {
  width: 1.1em;
  text-align: center;
  color: var(--sub);
}
.next-checks-list {
  display: grid;
  gap: 8px;
  min-height: 0;
  flex: 1;
  grid-template-rows: repeat(2, minmax(0, 1fr));
  align-content: stretch;
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 2px;
}
.next-check-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 9px 10px;
  border: 1px solid var(--line);
  border-radius: 8px;
  background: var(--panel-2);
  min-height: clamp(44px, 4.8vh, 62px);
}
.next-check-item .label {
  display: inline-flex;
  align-items: center;
  gap: 0.5em;
}
.next-check-item .label i {
  width: 1.1em;
  text-align: center;
  color: var(--sub);
}
.next-check-item .value {
  color: var(--accent);
  font-weight: 700;
}

.switches-list { display: grid; gap: 16px; }
.switch-inline-row {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: clamp(6px, 0.8vh, 12px);
}
.switch-inline-row .switch-item {
  min-width: 0;
}
.switch-inline-item {
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  gap: clamp(4px, 0.6vh, 8px);
  text-align: center;
}
.switch-inline-item .switch-inline-label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 100%;
}
.switch-item { display: flex; justify-content: space-between; align-items: center; font-size: calc(16px * var(--font-scale)); }
.switch-item input { display: none; }
.slider {
  width: clamp(calc(34px * var(--font-scale)), 3.3vh, calc(52px * var(--font-scale)));
  height: clamp(calc(18px * var(--font-scale)), 1.9vh, calc(28px * var(--font-scale)));
  border-radius: 999px;
  background: #3a4652;
  position: relative;
  border: 1px solid var(--line);
}
.slider::before {
  content: "";
  width: clamp(calc(12px * var(--font-scale)), 1.3vh, calc(20px * var(--font-scale)));
  height: clamp(calc(12px * var(--font-scale)), 1.3vh, calc(20px * var(--font-scale)));
  border-radius: 50%;
  background: #fff;
  position: absolute;
  top: 50%;
  left: clamp(2px, 0.25vh, 4px);
  transform: translateY(-50%);
  transition: .18s;
}
.switch-item input:checked + .slider { background: rgba(24,160,111,.75); border-color: rgba(24,160,111,.85); }
.switch-item input:checked + .slider::before {
  left: calc(100% - clamp(calc(12px * var(--font-scale)), 1.3vh, calc(20px * var(--font-scale))) - clamp(2px, 0.25vh, 4px));
}
.friend-sub-controls {
  margin: 0;
  width: 100%;
  padding: clamp(6px, 0.8vh, 10px) 0;
  border: 1px solid var(--line);
  border-radius: 10px;
  background: var(--panel-2);
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: clamp(calc(6px * var(--font-scale)), 0.9vh, calc(12px * var(--font-scale)));
}
.friend-sub-item {
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  gap: clamp(4px, 0.6vh, 8px);
  text-align: center;
}
.friend-sub-item .friend-sub-label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 100%;
}
.friend-sub-controls.disabled { opacity: .5; pointer-events: none; }

.btn { border: 1px solid var(--line); background: var(--panel-2); color: var(--text); border-radius: 8px; padding: 7px 11px; cursor: pointer; font-size: calc(14px * var(--font-scale)); }
.btn:hover { border-color: var(--primary); }
.btn-primary { background: var(--btn-primary-bg); border-color: transparent; color: #fff; }
.btn-primary:hover { filter: brightness(.94); }
.btn-sm { font-size: calc(13px * var(--font-scale)); padding: 6px 9px; }
.btn-ghost { background: transparent; }
.actions-group { display: flex; gap: 5px; flex-wrap: wrap; }

.summary { margin-bottom: 6px; text-align: right; color: var(--sub); font-size: calc(13px * var(--font-scale)); }
.farm-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(104px,1fr)); gap: 8px; }
.farm-grid {
  grid-template-columns: repeat(auto-fill, minmax(clamp(96px, calc(112px * var(--font-scale)), 180px), 1fr));
  gap: clamp(6px, 0.8vh, 12px);
}
.land-cell {
  position: relative;
  border-radius: 10px;
  border: 2px solid transparent;
  background: var(--panel-2);
  min-height: clamp(82px, calc(92px * var(--font-scale)), 150px);
  padding: clamp(5px, 0.6vh, 10px);
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.land-cell .id { position: absolute; left: 5px; top: 5px; font-size: calc(10px * var(--font-scale)); }
.land-cell .needs { position: absolute; right: 5px; bottom: 5px; font-size: calc(10px * var(--font-scale)); background: var(--danger); color: #fff; padding: 1px 4px; border-radius: 6px; }
.land-crop-image {
  width: clamp(24px, calc(30px * var(--font-scale)), 50px);
  height: clamp(24px, calc(30px * var(--font-scale)), 50px);
  object-fit: contain;
  margin: 4px auto 2px;
  display: block;
  pointer-events: none;
  user-select: none;
}
.plant-name { font-size: calc(14px * var(--font-scale)); font-weight: 700; }
.phase-name, .land-meta { font-size: calc(12px * var(--font-scale)); opacity: .9; }
.land-cell.harvestable { border-color: #f3be4f; }
.land-cell.dead { opacity: .66; }
.land-cell.land-level-0 { background: #2b2f33; border-color: #454f58; color: #d5dde4; }
.land-cell.land-level-1 { background: #6e5716; border-color: #8c6f1e; color: #f7e7b5; }
.land-cell.land-level-2 { background: #6b1e1e; border-color: #8b2a2a; color: #ffe6e6; }
.land-cell.land-level-3 { background: #141414; border-color: #090909; color: #eaeaea; }
.land-cell.land-level-4 { background: #6f5b16; border-color: #8f7420; color: #f9e8a8; }
body.light-theme .land-cell.land-level-0 { background: #d7d7d7; border-color: #bdbdbd; color: #333; }
body.light-theme .land-cell.land-level-1 { background: #f2c14e; border-color: #d8a730; color: #2b1e00; }
body.light-theme .land-cell.land-level-2 { background: #d9534f; border-color: #b53a37; color: #fff5f5; }
body.light-theme .land-cell.land-level-3 { background: #2f2f2f; border-color: #1b1b1b; color: #f0f0f0; }
body.light-theme .land-cell.land-level-4 { background: #d4af37; border-color: #b9962f; color: #2d2300; }

.friends-list { display: grid; gap: 6px; }
.friends-list { margin-top: 6px; }
.friend-item { border: 1px solid var(--line); border-radius: 10px; background: var(--panel-2); overflow: hidden; }
.friend-header { display: flex; justify-content: space-between; padding: 8px 10px; cursor: pointer; }
.friend-header:hover { filter: brightness(1.05); }
.friend-header .name {
  font-size: clamp(calc(15px * var(--font-scale)), calc(17px * var(--font-scale)), calc(24px * var(--font-scale)));
  font-weight: 600;
}
.friend-header .preview {
  font-size: clamp(calc(14px * var(--font-scale)), calc(16px * var(--font-scale)), calc(22px * var(--font-scale)));
  color: var(--sub);
}
.friend-header .preview.has-work { color: var(--primary); font-weight: 700; }
.friend-actions { display: flex; gap: 6px; flex-wrap: wrap; padding: 0 10px 8px; }
.friend-actions .btn {
  font-size: clamp(calc(13px * var(--font-scale)), calc(15px * var(--font-scale)), calc(20px * var(--font-scale)));
  padding: clamp(5px, 0.55vh, 8px) clamp(9px, 0.9vw, 12px);
}
.friend-lands {
  padding-left: clamp(8px, calc(10px * var(--font-scale)), 16px);
  padding-right: clamp(8px, calc(10px * var(--font-scale)), 16px);
  padding-bottom: clamp(8px, calc(10px * var(--font-scale)), 16px);
}
.farm-grid.mini {
  grid-template-columns: repeat(auto-fill, minmax(clamp(84px, calc(96px * var(--font-scale)), 150px), 1fr));
  gap: clamp(5px, 0.7vh, 10px);
}
.farm-grid.mini .land-cell {
  min-height: clamp(72px, calc(82px * var(--font-scale)), 128px);
  padding: clamp(4px, 0.5vh, 8px);
}
.farm-grid.mini .plant-name {
  font-size: calc(13px * var(--font-scale));
}
.farm-grid.mini .land-crop-image {
  width: clamp(20px, calc(24px * var(--font-scale)), 42px);
  height: clamp(20px, calc(24px * var(--font-scale)), 42px);
  margin: 2px auto 1px;
}
.farm-grid.mini .phase-name,
.farm-grid.mini .land-meta {
  font-size: calc(11px * var(--font-scale));
}

.bag-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 8px;
}
.bag-item {
  border: 1px solid var(--line);
  border-radius: 10px;
  background: var(--panel-2);
  padding: 8px;
  display: grid;
  gap: 3px;
}
.thumb-wrap {
  width: clamp(40px, calc(48px * var(--font-scale)), 72px);
  height: clamp(40px, calc(48px * var(--font-scale)), 72px);
  border: 1px solid var(--line);
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.04);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
body.light-theme .thumb-wrap {
  background: rgba(0, 0, 0, 0.04);
}
.bag-thumb {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}
.bag-thumb-fallback {
  font-size: calc(16px * var(--font-scale));
  font-weight: 700;
  color: var(--sub);
  display: none;
}
.thumb-wrap.fallback .bag-thumb-fallback {
  display: inline-flex;
}
.thumb-wrap.fallback .bag-thumb {
  display: none !important;
}
.bag-item .name {
  font-weight: 700;
  font-size: calc(15px * var(--font-scale));
}
.bag-item .meta {
  font-size: calc(12px * var(--font-scale));
  color: var(--sub);
}
.bag-item .count {
  font-size: calc(18px * var(--font-scale));
  font-weight: 700;
  color: var(--accent);
}

.accounts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(clamp(180px, calc(220px * var(--font-scale)), 320px), 1fr));
  gap: clamp(8px, 0.9vh, 14px);
}
.acc-item {
  border: 1px solid var(--line);
  border-radius: 10px;
  background: var(--panel-2);
  padding: clamp(8px, 0.8vh, 14px);
}
.acc-item .name {
  font-weight: 700;
  font-size: calc(16px * var(--font-scale));
}
.acc-actions {
  margin-top: clamp(8px, 0.9vh, 14px);
  display: flex;
  gap: clamp(6px, 0.8vh, 12px);
  justify-content: flex-end;
  flex-wrap: wrap;
}
.acc-btn {
  font-size: calc(13px * var(--font-scale));
  padding: clamp(4px, 0.5vh, 8px) clamp(9px, 1vw, 14px);
}
.acc-btn-stop {
  background: var(--btn-stop-bg);
  color: #fff;
}
.acc-btn-danger {
  background: var(--btn-danger-bg);
  border-color: transparent;
  color: #fff;
}
.acc-btn-danger:hover { filter: brightness(.94); }

/* 浅色主题下：有背景色按钮统一使用深色前景 */
body.light-theme .btn-primary,
body.light-theme .acc-btn-stop,
body.light-theme .acc-btn-danger,
body.light-theme .tab-btn.active {
  color: #1f2a33;
}

/* 添加账号弹窗关键按钮：强制跟随主题背景 */
#btn-qr-generate,
#btn-save-acc {
  background: var(--btn-primary-bg);
  border-color: transparent;
  color: #fff;
}
#btn-qr-open-url {
  display: none;
  font-weight: 700;
  background: var(--btn-primary-bg);
  border-color: transparent;
  color: #fff;
}
#btn-qr-open-url:hover {
  filter: brightness(0.98);
}
body.light-theme #btn-qr-generate,
body.light-theme #btn-save-acc,
body.light-theme #btn-qr-open-url {
  color: #1f2a33;
}

.settings-grid { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 8px 10px; }
.settings-grid .full { grid-column: 1/-1; }
.checkbox-inline { display: inline-flex; gap: 8px; align-items: center; }
.save-btn { width: 100%; }
.compact-select { width: 140px; }
.settings-layout {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: clamp(10px, 1.2vh, 18px);
  align-items: stretch;
}
.settings-layout > .card {
  margin-bottom: 0;
}
#page-settings .settings-layout > .card:last-child {
  align-self: start;
}
.settings-actions {
  margin-top: clamp(10px, 1.2vh, 18px);
}

/* 分析页表格宽度约束，避免移动端撑宽页面 */
#analytics-list {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;
}
#analytics-list table {
  width: 100% !important;
  max-width: 100%;
  table-layout: fixed;
  font-size: clamp(calc(17px * var(--font-scale)), calc(20px * var(--font-scale)), calc(28px * var(--font-scale)));
}
#analytics-list th,
#analytics-list td {
  word-break: break-word;
  overflow-wrap: anywhere;
  padding: clamp(8px, 0.9vh, 16px) clamp(7px, 1vw, 14px);
}


/* Settings page readability */
#page-settings .card-head {
  margin-bottom: clamp(10px, 1.2vh, 22px);
}
#page-settings .settings-grid {
  grid-template-columns: repeat(2, minmax(clamp(160px, 18vw, 260px), 1fr));
  gap: clamp(10px, 1.2vh, 18px) clamp(12px, 1vw, 20px);
}
#page-settings .form-group { margin-bottom: clamp(2px, 0.3vh, 8px); }
#page-settings .form-group label {
  display: block;
  margin-bottom: clamp(5px, 0.7vh, 10px);
  font-size: clamp(calc(15px * var(--font-scale)), calc(17px * var(--font-scale)), calc(20px * var(--font-scale)));
  color: var(--text);
  line-height: 1.35;
}
#page-settings .form-control {
  font-size: clamp(calc(14px * var(--font-scale)), calc(16px * var(--font-scale)), calc(19px * var(--font-scale)));
  padding: clamp(8px, 0.85vh, 12px) clamp(9px, 0.8vw, 12px);
  min-height: clamp(38px, 4.2vh, 46px);
  border-radius: 10px;
  width: 100%;
  max-width: none;
}
#page-settings #strategy-select,
#page-settings #seed-select,
#page-settings #interval-farm-min,
#page-settings #interval-farm-max,
#page-settings #interval-friend-min,
#page-settings #interval-friend-max {
  width: 100%;
  max-width: none;
}
#page-settings .checkbox-inline {
  gap: clamp(8px, 0.8vh, 12px);
  font-size: clamp(calc(15px * var(--font-scale)), calc(17px * var(--font-scale)), calc(20px * var(--font-scale)));
}
#page-settings .checkbox-inline input[type="checkbox"] {
  width: clamp(16px, 1.5vh, 20px);
  height: clamp(16px, 1.5vh, 20px);
}
#page-settings .save-btn {
  margin-top: clamp(10px, 1vh, 16px);
  font-size: clamp(calc(15px * var(--font-scale)), calc(17px * var(--font-scale)), calc(20px * var(--font-scale)));
  padding: clamp(10px, 1vh, 13px) clamp(12px, 1vw, 16px);
}
#page-settings #btn-change-admin-password {
  margin-top: 0 !important;
  height: clamp(38px, 4.2vh, 46px);
  min-height: clamp(38px, 4.2vh, 46px);
  padding: 0 clamp(12px, 1vw, 16px);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
#page-settings .form-group.password-action {
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
}
#page-settings #card-efficiency {
  display: flex;
  flex-direction: column;
  min-height: 0;
}
#page-settings #card-efficiency .switches-list {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  gap: clamp(8px, 1vh, 14px);
}
#page-dashboard .side-stack > .card:has(#next-checks-list) {
  display: flex;
  flex-direction: column;
  min-height: clamp(140px, 18vh, 220px);
}

.modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.55); z-index: 100; }
.modal.show { display: flex; }
.modal-content { width: min(92vw, 500px); background: var(--panel); border: 1px solid var(--line); border-radius: 12px; padding: 10px; }
.chart-modal { width: min(95vw, 760px); }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.modal-header h3 { margin: 0; font-size: calc(17px * var(--font-scale)); }
.close-modal { cursor: pointer; font-size: calc(22px * var(--font-scale)); color: var(--sub); }
.close-modal:hover { color: var(--text); }
.modal-footer { display: flex; justify-content: flex-end; gap: 6px; margin-top: 8px; }

.tabs { display: flex; gap: 6px; margin-bottom: 8px; }
.tab-btn {
  border: 1px solid var(--line);
  border-radius: 8px;
  background: var(--tab-btn-bg);
  color: var(--text);
  padding: 7px 10px;
  cursor: pointer;
  font-size: calc(14px * var(--font-scale));
}
.tab-btn.active {
  background: var(--tab-btn-active-bg);
  color: var(--tab-btn-active-text);
  border-color: var(--tab-btn-active-bg);
}

#modal-add-acc .tabs {
  justify-content: center;
  align-items: center;
  gap: 14px;
}
.qr-wrap { min-height: 200px; display: grid; place-items: center; gap: 6px; }
.qr-display { display: grid; place-items: center; gap: 6px; }
#qr-code-img { width: 184px; height: 184px; border-radius: 8px; border: 1px solid var(--line); background: #fff; }

/* Add account modal (desktop-first) */
#modal-add-acc .modal-content {
  width: min(86vw, 300px);
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  padding: 10px;
}
#modal-add-acc .modal-body {
  overflow: auto;
  padding-right: 2px;
}
#modal-add-acc #tab-manual,
#modal-add-acc #tab-qrcode {
  padding-top: 2px;
}
#modal-add-acc #tab-manual .form-group {
  margin-bottom: 14px;
}
#modal-add-acc #tab-manual .form-group:last-child {
  margin-bottom: 0;
}
#modal-add-acc #tab-manual .form-group label {
  display: block;
  text-align: center;
  margin-bottom: 10px;
}
#modal-add-acc #tab-manual #acc-name,
#modal-add-acc #tab-manual #acc-code,
#modal-add-acc #tab-manual #acc-platform {
  width: min(100%, 240px);
  margin: 0 auto;
  display: block;
  text-align: center;
  text-align-last: center;
}
#modal-add-acc #tab-manual #acc-name::placeholder,
#modal-add-acc #tab-manual #acc-code::placeholder {
  text-align: center;
}
#modal-add-acc #tab-qrcode .form-group {
  margin-bottom: 8px;
}
#modal-add-acc #tab-qrcode .form-group label {
  display: block;
  text-align: center;
  margin-bottom: 10px;
}
#modal-add-acc #tab-qrcode #acc-name-qr {
  width: min(100%, 240px);
  margin: 0 auto;
  display: block;
  text-align: center;
}
#modal-add-acc #tab-qrcode #acc-name-qr::placeholder {
  text-align: center;
}
#modal-add-acc #qr-container {
  min-height: 236px;
  border: 1px dashed var(--line);
  border-radius: 10px;
  background: var(--panel-2);
  padding: 10px;
}
#modal-add-acc #qr-code-display {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
#modal-add-acc #qr-status {
  text-align: center;
  font-size: calc(12px * var(--font-scale));
  color: var(--sub);
}
#modal-add-acc .modal-footer {
  justify-content: center;
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px solid var(--line);
}

.login-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.6); z-index: 120; }
.login-overlay.show { display: flex; }
.login-card { width: min(90vw, 330px); background: var(--panel); border: 1px solid var(--line); border-radius: 12px; padding: 14px; }
.login-title { font-size: calc(20px * var(--font-scale)); font-weight: 700; }
.login-sub { font-size: calc(13px * var(--font-scale)); color: var(--sub); margin: 3px 0 8px; }
.login-input { width: 100%; border: 1px solid var(--line); border-radius: 8px; background: var(--panel-2); color: var(--text); padding: 8px 10px; }
.login-input:focus { outline: none; border-color: var(--primary); }
.password-wrap {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
}
.password-wrap .form-control,
.password-wrap .login-input {
  width: 100%;
  padding-right: 42px;
}
.password-toggle {
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  border: 1px solid var(--line);
  background: var(--panel);
  color: var(--sub);
  border-radius: 8px;
  width: 30px;
  height: 30px;
  min-width: 30px;
  padding: 0;
  cursor: pointer;
  font-size: calc(13px * var(--font-scale));
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.password-toggle:hover {
  color: var(--text);
  border-color: var(--primary);
}
.password-toggle[aria-pressed="true"] {
  color: var(--primary);
  border-color: var(--primary);
}
/* 隐藏浏览器原生密码可见按钮，避免和自定义按钮并存 */
input[type="password"]::-ms-reveal,
input[type="password"]::-ms-clear {
  display: none;
}
input[type="password"]::-webkit-credentials-auto-fill-button,
input[type="password"]::-webkit-password-reveal-button {
  display: none !important;
  visibility: hidden;
  pointer-events: none;
}
.login-error { min-height: 20px; color: var(--danger); font-size: calc(13px * var(--font-scale)); margin-top: 6px; }
.login-btn { width: 100%; }

.value-changed, .value-changed-gold { animation: bump .4s ease; display: inline-block; }
@keyframes bump { 0% { transform: scale(1); } 45% { transform: scale(1.16); } 100% { transform: scale(1); } }

::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-thumb { background: rgba(124,148,170,.45); border-radius: 999px; }
::-webkit-scrollbar-track { background: transparent; }

@media (max-width: 1280px) {
  .compact-status { grid-template-columns: repeat(4,minmax(0,1fr)); }
  .status-item.stretch { grid-column: span 2; }
}
@media (max-width: 1200px) {
  .dashboard-grid { grid-template-columns: 1fr; gap: 12px; }
  .settings-layout { grid-template-columns: 1fr; }
}
@media (max-width: 980px) {
  html, body { height: auto; min-height: 100%; }
  body { overflow: auto; overflow-x: hidden; padding-left: 10px; padding-right: 10px; }
  .app-shell,
  .app-main,
  .page-wrap,
  .page,
  .card,
  .dashboard-grid,
  .logs-card,
  .side-stack,
  .friends-list,
  .accounts-grid,
  .farm-grid,
  .bag-list,
  .logs-container,
  .log-row {
    min-width: 0;
    max-width: 100%;
  }
  .app-shell,
  .app-main,
  .page-wrap {
    overflow-x: clip;
  }
  .app-shell { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
  .app-shell { height: auto; min-height: 100dvh; }
  .app-sidebar {
    border-right: 0;
    border-bottom: 1px solid var(--line);
    position: sticky;
    top: 0;
    z-index: 10;
    padding: 8px;
    gap: 8px;
  }
  .brand {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: calc(26px * var(--font-scale));
    padding: 8px 6px 6px;
  }
  .brand i { font-size: calc(28px * var(--font-scale)); }
  .current-account { padding: 7px 9px; font-size: calc(14px * var(--font-scale)); }
  .account-dropdown { max-height: 180px; }
  .nav-list {
    display: grid;
    grid-template-columns: repeat(7, minmax(0, 1fr));
    overflow-x: hidden;
    gap: 4px;
  }
  .nav-item { justify-content: center; padding: 7px 6px; font-size: calc(13px * var(--font-scale)); }
  .nav-item span { display: none; }
  .sidebar-foot {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 6px 8px;
  }
  .uptime-mini, .system-time { margin-top: 0; white-space: nowrap; }

  .app-main { grid-template-rows: 54px auto; min-height: 0; }
  .topbar { padding: 0 10px; }
  .topbar h1 { font-size: calc(18px * var(--font-scale)); }
  .page-wrap { padding: 10px; overflow: visible; }
  .card { padding: 10px; margin-bottom: 10px; }

  .compact-status { grid-template-columns: repeat(2,minmax(0,1fr)); }
  .status-item.stretch { grid-column: span 2; }
  .status-item { min-height: 72px; padding: 8px; }
  .status-item .k { font-size: calc(13px * var(--font-scale)); }
  .status-item .v { font-size: calc(24px * var(--font-scale)); }
  .status-item .s { font-size: calc(13px * var(--font-scale)); }

  .dashboard-grid { grid-template-columns: 1fr; gap: 12px; }
  .side-stack { gap: 12px; }
  .logs-card { height: auto; max-height: none; }
  .logs-container {
    height: 320px;
    min-height: 320px;
    max-height: 320px;
    font-size: calc(14px * var(--font-scale));
    overflow-x: auto;
    overflow-y: auto;
  }
  .logs-container .log-row {
    min-width: max-content;
  }
  .logs-container .log-msg {
    min-width: max-content;
    white-space: nowrap;
    overflow: visible;
    text-overflow: clip;
  }
  .card-head { flex-wrap: wrap; gap: 6px; }
  .card-head h3 { font-size: calc(20px * var(--font-scale)); }
  .log-filters {
    width: 100%;
    justify-content: flex-start;
    gap: 6px;
  }
  .log-filter-select, .log-filter-input {
    flex: 1 1 120px;
    width: auto;
    min-width: 0;
  }
  #logs-keyword-filter {
    flex-basis: 180px;
  }
  .log-filter-input:focus { width: auto; }

  .switches-list { gap: 12px; }
  .switch-inline-row { gap: 8px; }
  .switch-item { font-size: calc(15px * var(--font-scale)); }
  #page-dashboard #card-efficiency .form-group.compact {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    align-items: center;
    justify-content: stretch;
    gap: 8px;
  }
  #page-dashboard #card-efficiency .form-group.compact label {
    margin: 0;
    font-size: calc(15px * var(--font-scale));
    line-height: 1.2;
    grid-column: 1;
    text-align: center;
    justify-content: center;
  }
  #page-dashboard #card-efficiency .form-group.compact .form-control {
    grid-column: 3;
    justify-self: center;
    width: min(100%, var(--fert-select-width));
    min-width: clamp(86px, calc(96px * var(--font-scale)), 120px);
    max-width: var(--fert-select-width);
    margin: 0;
  }
  #page-dashboard #card-efficiency #fertilizer-select {
    text-align: center;
    text-align-last: center;
  }
  #page-dashboard #card-efficiency #fertilizer-select option {
    text-align: center;
  }
  .actions-group { gap: 6px; }
  .btn { font-size: calc(14px * var(--font-scale)); }
  .btn-sm { font-size: calc(13px * var(--font-scale)); }

  .farm-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 6px; }
  .land-cell { min-height: 82px; }
  .plant-name { font-size: calc(13px * var(--font-scale)); }
  .phase-name, .land-meta { font-size: calc(11px * var(--font-scale)); }
  .bag-list { grid-template-columns: 1fr; }

  .accounts-grid { grid-template-columns: 1fr; }
  .settings-grid { grid-template-columns: 1fr; gap: 8px; }
  .settings-layout { grid-template-columns: 1fr; }
  .settings-actions { margin-top: 10px; }
  .compact-select { width: 100%; }
  #analytics-list table { font-size: calc(14px * var(--font-scale)) !important; }
  #analytics-list th, #analytics-list td { padding: 8px 6px !important; }
  .modal-content { width: min(96vw, 560px); }
  #modal-add-acc .modal-content { width: min(94vw, 300px); max-height: 92vh; }
  #modal-add-acc #qr-container { min-height: 214px; }

  #page-settings .settings-grid { grid-template-columns: 1fr; gap: 12px; }
  #page-settings .form-group label { font-size: calc(16px * var(--font-scale)); margin-bottom: 6px; }
  #page-settings .form-control {
    width: 100%;
    max-width: 100%;
    font-size: calc(16px * var(--font-scale));
    min-height: 42px;
    padding: 10px 10px;
  }
  #page-settings .checkbox-inline { font-size: calc(16px * var(--font-scale)); }
  #page-settings .save-btn { font-size: calc(16px * var(--font-scale)); padding: 11px 12px; }
  #page-settings #btn-change-admin-password {
    margin-top: 0 !important;
    height: 42px;
    min-height: 42px;
    padding: 0 12px;
  }
}

@media (max-width: 640px) {
  .switch-inline-row { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  body { padding-left: 8px; padding-right: 8px; }
  .nav-list { grid-template-columns: repeat(7, minmax(0, 1fr)); }
  .nav-item { padding: 6px 4px; }
  .topbar h1 { font-size: calc(17px * var(--font-scale)); }
  .status-account img,
  .status-account #topbar-account-fallback {
    width: clamp(calc(38px * var(--font-scale)), 4.5vh, calc(56px * var(--font-scale)));
    height: clamp(calc(38px * var(--font-scale)), 4.5vh, calc(56px * var(--font-scale)));
  }
  .status-account #topbar-account-name { max-width: 140px; }

  .compact-status { grid-template-columns: 1fr; }
  .status-item.stretch { grid-column: span 1; }
  .status-item { min-height: 66px; }
  .status-item .v { font-size: calc(22px * var(--font-scale)); }

  .logs-container { height: 280px; min-height: 280px; max-height: 280px; font-size: calc(13px * var(--font-scale)); }
  .log-time { min-width: 62px; }
  .log-tag { min-width: 52px; }

  .farm-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .actions-group { width: 100%; }
  .actions-group .btn { flex: 1 1 calc(50% - 6px); }
  .switch-item { font-size: calc(14px * var(--font-scale)); }
  #analytics-list table { font-size: calc(13px * var(--font-scale)) !important; }
  #analytics-list th, #analytics-list td { padding: 7px 5px !important; }
  .modal-content { width: 96vw; padding: 8px; }
  #modal-add-acc .modal-content { width: min(96vw, 300px); padding: 8px; max-height: 94vh; }
  #modal-add-acc #qr-container { min-height: 196px; padding: 8px; }
  #qr-code-img { width: 172px; height: 172px; }
  .login-card { width: 94vw; padding: 12px; }
}


@media (min-width: 2200px) and (min-height: 1300px) {
  .brand { font-size: calc(38px * var(--font-scale)); }
  .brand i { font-size: calc(40px * var(--font-scale)); }
  .current-account { font-size: calc(18px * var(--font-scale)); }
  .account-option { font-size: calc(17px * var(--font-scale)); }
  .nav-item { font-size: calc(20px * var(--font-scale)); }
  .sidebar-foot { font-size: calc(15px * var(--font-scale)); }
  .conn { font-size: calc(20px * var(--font-scale)); }
  .system-time { font-size: calc(18px * var(--font-scale)); }
}

@media (min-width: 981px) and (max-width: 1919px), (min-width: 981px) and (max-height: 1199px) {
  .brand { font-size: clamp(30px, calc(34px * var(--font-scale)), 36px); }
  .brand i { font-size: clamp(31px, calc(36px * var(--font-scale)), 38px); }
  .current-account { font-size: clamp(15px, calc(16px * var(--font-scale)), 18px); }
  .account-option { font-size: clamp(14px, calc(15px * var(--font-scale)), 17px); }
  .nav-item { font-size: clamp(16px, calc(18px * var(--font-scale)), 20px); }
  .sidebar-foot { font-size: clamp(13px, calc(14px * var(--font-scale)), 16px); }
  .conn { font-size: clamp(17px, calc(18px * var(--font-scale)), 20px); }
  .system-time { font-size: clamp(15px, calc(16px * var(--font-scale)), 18px); }
}

